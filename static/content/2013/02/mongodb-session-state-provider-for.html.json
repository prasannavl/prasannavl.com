{"name":"MongoDB Session State Provider for ASP.NET","date":"2013-02-22T00:00:00.000Z","url":"2013/02/mongodb-session-state-provider-for.html","tags":[],"content":"I've been pretty impressed with the recent development of MongoDB, and it seems to me that their one biggest problem of data consistency has now been solved.\r\n\r\nAnd so, I decided to give it base one of our upcoming projects fully on MongoDB. But after some Googling I found out all the session providers out there are pretty outdated using deprecated libraries, or not suited for high-performance needs.\r\n\r\nSo, here's a session provider for ASP.NET.\r\n\r\n**Installation:**\r\n> PM> Install-Package PVL.MongoSessionProvider\r\n\r\n**NuGet Pacakge Link:** [https://nuget.org/packages/PVL.MongoSessionProvider/](https://nuget.org/packages/PVL.MongoSessionProvider/)\r\n**Code:** [https://github.com/prasannavl/MongoSessionProvider](https://github.com/prasannavl/MongoSessionProvider)\r\n\r\n**Example session document:**\r\n\r\n```js\r\n> use SessionState;\r\n> db.Sessions.find().pretty();\r\n\r\n{\r\n    \"_id\": \"i2guetwsm0mgaibb1gqmodfq\",\r\n    \"App\": \"/\",\r\n    \"Created\": ISODate(\"2013-02-21T22:27:32.091Z\"),\r\n    \"Expires\": ISODate(\"2013-02-22T22:30:59.267Z\"),\r\n    \"LockDate\": ISODate(\"2013-02-21T22:29:54.481Z\"),\r\n    \"LockId\": 1,\r\n    \"Timeout\": 20,\r\n    \"Locked\": true,\r\n    \"Items\": \"AQAAAP////8EVGVzdAgAAAABBkFkcmlhbg==\",\r\n    \"Flags\": 0\r\n}\r\n```\r\n\r\n**Scheduled session cleanup command:**\r\n> db.Sessions.remove({\"Expires\" : {$lt : new Date() }})\r\n\r\n**Example web.config settings:**\r\n\r\n```xml\r\n<connectionStrings>\r\n   <add name=\"SessionState\" connectionString=\"mongodb://localhost\"/>\r\n</connectionStrings>\r\n<system.web>\r\n    <sessionState mode=\"Custom\" timeout=\"1440\" cookieless=\"false\" customProvider=\"MongoSessionStateProvider\">\r\n        <providers>\r\n            <add name=\"MongoSessionStateProvider\" type=\"PVL.MongoSessionProvider\" connectionStringName=\"SessionState\" writeExceptionsToEventLog=\"false\"/>\r\n        </providers>\r\n     </sessionState>\r\n</system.web>\r\n```\r\n\r\n Happy Coding!"}